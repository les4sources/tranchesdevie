<div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow h-full flex flex-col">
  <!-- Product Image Placeholder -->
  <div class="h-32 sm:h-40 md:h-48 bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center flex-shrink-0">
    <svg class="h-16 sm:h-20 w-16 sm:w-20 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
    </svg>
  </div>

  <!-- Product Info -->
  <div class="p-4 md:p-6 flex-1 flex flex-col">
    <% if product.category.present? %>
      <span class="inline-block px-2 py-1 text-xs font-semibold text-amber-800 bg-amber-100 rounded-full mb-2">
        <%= product.category %>
      </span>
    <% end %>
    
    <h3 class="text-lg md:text-xl font-bold text-gray-900 mb-2"><%= product.name %></h3>
    
    <% if product.description.present? %>
      <p class="text-xs md:text-sm text-gray-600 mb-3 md:mb-4 line-clamp-2"><%= product.description %></p>
    <% end %>

    <!-- Variants -->
    <div class="space-y-3">
      <% product.available_variants.each do |variant| %>
        <% 
          capacity = CapacityChecker.new(variant, selected_bake_day)
          orderable = variant_orderable?(variant, selected_bake_day)
          available = variant_available_on_bake_day?(variant, selected_bake_day)
        %>
        
        <div class="border border-gray-200 rounded-lg overflow-hidden <%= orderable ? 'hover:border-amber-400 hover:shadow-md transition-all' : 'opacity-60 bg-gray-50' %>">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between p-2 md:p-3 gap-2 sm:gap-0">
            <div class="flex-1">
              <div class="font-medium text-gray-900">
                <%= variant.name %>
                <% if variant.weight_grams.present? %>
                  <span class="text-sm text-gray-500">(<%= variant.weight_grams %>g)</span>
                <% end %>
              </div>
              
              <% unless available %>
                <div class="text-xs text-orange-600 mt-1">
                  ❌ Non disponible ce jour
                </div>
              <% elsif capacity.has_capacity_limit? %>
                <div class="text-xs <%= capacity.status_text_class %> mt-1">
                  <%= capacity.status_message %>
                </div>
              <% end %>
            </div>
            
            <div class="flex sm:flex-col items-center sm:items-end justify-between sm:justify-start sm:text-right gap-2 sm:gap-1">
              <div class="text-base md:text-lg font-bold text-gray-900">
                €<%= sprintf('%.2f', variant.price_euros) %>
              </div>
              
              <% if orderable %>
                <button class="px-4 py-2 text-sm font-medium bg-amber-500 text-white rounded-lg hover:bg-amber-600 active:bg-amber-700 transition-colors shadow-sm whitespace-nowrap">
                  Ajouter
                </button>
              <% else %>
                <div class="px-4 py-2 text-sm bg-gray-200 text-gray-500 rounded-lg cursor-not-allowed whitespace-nowrap">
                  Indisponible
                </div>
              <% end %>
            </div>
          </div>
          
          <!-- Capacity Progress Bar -->
          <% if capacity.show_progress_bar? %>
            <div class="px-3 pb-3">
              <div class="flex items-center gap-2">
                <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                  <div class="h-full <%= capacity.progress_bar_class %> transition-all duration-300" 
                       style="width: <%= capacity.percentage_reserved %>%"></div>
                </div>
                <span class="text-xs font-medium text-gray-600">
                  <%= capacity.percentage_reserved.round %>%
                </span>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

